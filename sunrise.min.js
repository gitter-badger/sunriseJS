!function(a){function b(a,b){for(var c=[],e=[],g=0;g<b.length;){for(c=[],e=[];!f.isFunction(b[g]);)c.push(b[g]),g++;for(;f.isFunction(b[g]);)e.push(b[g]),g++;for(var h=0;h<c.length;h++)void 0==d.controls[a][c[h]]&&(d.controls[a][c[h]]=e),d.controls[a][c[h]]=d.controls[a][c[h]].concat(e).filter(f.onlyUnique),console.log("scheiÃŸe",d.controls[a][c[h]])}}var c=a.$rootScope=a.$rootScope||{},d=c.fn={};c.$scope={};var e=c.$scope.fn={};_seal=a._seal=a._seal||function(){delete a.$rootScope,delete a._seal,delete a._unseal},_unseal=a._unseal=a._unseal||function(){a.$rootScope=c,a._seal=_seal,a._unseal=_unseal},d.sunrise=function(){a._seal(),d.initCanvas(),e.loadImages(game.config.images,function(){e.loadSounds(game.config.sounds,function(){e.loadLevels(game.config.levels,function(){game.init(c.$scope),d.run()})})})},d.run=function(){d.clearCanvas(),d.stage.update(),d.checkCollisions(),game.run(c.$scope),d.stage.draw(),c.animationFrame.call(window,d.run)},e.fps={startTime:0,frameNumber:0,getFps:function(){this.frameNumber++;var a=(new Date).getTime(),b=(a-this.startTime)/1e3,c=Math.floor(this.frameNumber/b);return b>1&&(this.startTime=(new Date).getTime(),this.frameNumber=0),c}},d.init=function(){c.animationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}},c.dom=document.querySelector("div[sunriseJS-app]"),void 0!=c.dom?d.init():alert("no jsengine-app found"),e.loadScript=function(a,b){var c=document.createElement("script");c.type="text/javascript",c.src=a,c.async=!0,c.onload=b,document.body.appendChild(c)},d.initPlugins=function(){for(var a={},b=game.config.plugins.length-1;b>=0&&(a[b--]="plugins/"+game.config.plugins.pop()+".js"););for(var c in a)!function(b,c){e.loadScript(c,function(){delete a[b],0===Object.keys(a).length&&d.emit("all_plugins_loaded")})}(c,a[c])},function(){var a={};e.components={},e.components.add=function(b,c){if(void 0!==a[b])throw new Error('Component of type "'+b+'" already exist.');a[b]=c},e.components.create=function(b,c){if(void 0===a[b])throw new Error('No component of type "'+b+'" exists.');return a[b](c)}}(),c.events={},c.$scope.events={},d.emit=function(a,b){void 0!=c.events[a]?c.events[a].forEach(function(a){a(b)}):console.error("there is no event named: "+a)},d.on=function(a,b){void 0!=c.events[a]?c.events[a].push(b):(c.events[a]=[],c.events[a].push(b))},e.emit=function(a,b){void 0!=c.$scope.events[a]?c.$scope.events[a].forEach(function(a){a(b)}):console.error("there is no event named: "+a)},e.on=function(a,b){void 0!=c.$scope.events[a]?c.$scope.events[a].push(b):(c.$scope.events[a]=[],c.$scope.events[a].push(b))},e.controls={},d.controls={keys:{},keycallbacksDown:{},keycallbacksUp:{},keysPressed:{}},d.controls.init=function(){d.controls.generateKeys()},e.controls.onKeyDown=function(){b("keycallbacksDown",arguments)},e.controls.onKeyUp=function(){b("keycallbacksUp",arguments)},d.handleKeyDown=function(a){if(!d.controls.keysPressed[a.keyCode]){if(void 0!=d.controls.keycallbacksDown[d.controls.keys.names[a.keyCode]])for(var b=0;b<d.controls.keycallbacksDown[d.controls.keys.names[a.keyCode]].length;++b)d.controls.keycallbacksDown[d.controls.keys.names[a.keyCode]][b]();d.controls.keysPressed[a.keyCode]=!0}},d.handleKeyUp=function(a){if(void 0!=d.controls.keycallbacksUp[d.controls.keys.names[a.keyCode]])for(var b=0;b<d.controls.keycallbacksUp[d.controls.keys.names[a.keyCode]].length;++b)d.controls.keycallbacksUp[d.controls.keys.names[a.keyCode]][b]();d.controls.keysPressed[a.keyCode]=!1},d.on("canvas-fully-loaded",function(){c.canvas.addEventListener("keydown",d.handleKeyDown),c.canvas.addEventListener("keyup",d.handleKeyUp)}),e.controls.isKeyPressed=function(){var a=!0;for(i=-1;++i<arguments.length&&a;)a=d.controls.keysPressed[d.controls.keys.codes[arguments[i]]]||d.controls.keysPressed[arguments[i]];return a},d.controls.generateKeys=function(){var a={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,"pause/break":19,"caps lock":20,esc:27,space:32,"page up":33,"page down":34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,"delete":46,windows:91,"right click":93,"numpad *":106,"numpad +":107,"numpad -":109,"numpad .":110,"numpad /":111,"num lock":144,"scroll lock":145,"my computer":182,"my calculator":183,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222},b={ctl:17,pause:19,"break":19,caps:20,escape:27,pgup:33,pgdn:33,ins:45,del:46,spc:32};for(c=97;123>c;c++)a[String.fromCharCode(c)]=c-32;for(var c=48;58>c;c++)a[c-48]=c;for(c=1;13>c;c++)a["f"+c]=c+111;for(c=0;10>c;c++)a["numpad "+c]=c+96;var e={};for(c in a)e[a[c]]=c;for(var f in b)a[f]=b[f];d.controls.keys.codes=a,d.controls.keys.names=e},d.controls.init(),c.fn.initCanvas=function(){var a=game.config.screenWidth,b=game.config.screenHeight,e=document.createElement("canvas");e.id="sunriseJS-screen",e.width=a,e.height=b,e.tabIndex="1",c.dom.appendChild(e),c.canvas=e,c.canvas.context=e.getContext("2d"),e.focus(),d.emit("canvas-fully-loaded")},c.fn.clearCanvas=function(){c.canvas.context.save(),c.canvas.context.setTransform(1,0,0,1,0,0),c.canvas.context.clearRect(0,0,game.config.screenWidth,game.config.screenHeight),c.canvas.context.restore()},c.ressources={images:{},sprites:{},sounds:{},levels:{}},e.loadImages=function(a,b){var d={},e=0;for(key in a)d[key]=a[key],e++;if(0===e)return void b();for(title in d)!function(a,e){var f,g;if(console.log(e),"object"==typeof e){if(void 0===e.source)throw new Error('No attribute "source" found in image '+title);f=e.source,g=e,g.name=title}else f=e,g={},g.name=title;if(void 0!==c.ressources.images[a])throw new Error("Imageressource with name "+a+" already exists");var h=new Image;h.onload=function(){delete d[a],c.ressources.images[a]=this;var e=!0;for(index in d){e=!1;break}e&&b()},h.src=f}(title,d[title])},e.loadLevels=function(a,b){var d={},e=0;for(key in a)d[key]=a[key],e++;if(0===e)return void b();for(key in d)f.ajax(d[key],function(a){c.ressources.levels[key]=JSON.parse(a),delete d[key];var e=!0;for(index in d){e=!1;break}e&&b()})},e.loadSounds=function(a,b){var d={},e=0;for(key in a)d[key]=a[key],e++;if(0===e)return void b();for(title in d)!function(a,e){if(void 0===e.file)throw new Error('Please provide filename for sound "'+a+'".');if(void 0!==c.ressources.sounds[a])throw new Error("Soundsressource with name "+a+" already exists");var f=new Audio;f.preload="true",e.loop===!0&&addEventListener("timeupdate",function(){var a=.5;this.currentTime>this.duration-a&&(this.currentTime=0,this.play())},!1),f.addEventListener("loadeddata",function(){console.log('loaded sound "'+a+'"'),delete d[a],c.ressources.sounds[a]=this;var e=!0;for(index in d){e=!1;break}e&&b()},!1),f.onerror=function(){throw new Error('Error while loading sound "'+a+'"')},f.src=e.file,f.load()}(title,d[title])};var f=c.$scope.util={};f.ajax=function(a,b,c){var d;d=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),d.onreadystatechange=function(){4==d.readyState&&200==d.status&&b(d.responseText)},d.open("GET",a,!0),c?(d.setRequestHeader("Content-type","application/x-www-form-urlencoded"),d.send(c)):d.send()};var g=function(a,b,c){if("object"==typeof a){if(!a instanceof f.Vec2)throw new Error("Can't use "+a+"as Vec2");c(a)}else{if(void 0===b||"undefined"==typeof b)throw new Error("Excpected value for y");c(new f.Vec2(a,b))}};f.isFunction=function(a){var b={};return a&&"[object Function]"===b.toString.call(a)},f.Vec2=function(a,b){if("object"==typeof a){if(!a instanceof f.Vec2)throw new Error("Can't use "+a+"as Vec2");this.x=a.x,this.y=a.y}else this.x=a,this.y=b},f.Vec2.prototype.add=function(a,b){var c=this;g(a,b,function(a){c.x+=a.x,c.y+=a.y})},f.Vec2.add=function(a,b){return new f.Vec2(a.x+b.x,a.y+b.y)},f.Vec2.prototype.subtract=function(a,b){var c=this;g(a,b,function(a){c.x-=a.x,c.y-=a.y})},f.Vec2.subtract=function(a,b){return new f.Vec2(a.x-b.x,a.y-b.y)},f.Vec2.prototype.sub=f.Vec2.prototype.subtract,f.Vec2.sub=f.Vec2.subtract,f.Vec2.prototype.multiply=function(a){this.x*=a,this.y*=a},f.Vec2.multiply=function(a,b){var c=new f.Vec2(a);return c.multiply(b),c},f.Vec2.prototype.mul=f.Vec2.prototype.multiply,f.Vec2.mul=f.Vec2.multiply,f.Vec2.prototype.divide=function(a){this.multiply(1/a)},f.Vec2.divide=function(a,b){var c=new f.Vec2(a);return c.divide(b),c},f.Vec2.dot=function(a,b){return a.x*b.x+a.y*b.y},f.Vec2.prototype.div=f.Vec2.prototype.divide,f.Vec2.div=f.Vec2.divide,f.size=function(a){var b,c=0;for(b in a)a.hasOwnProperty(b)&&c++;return c},f.guid=function(){function a(a){var b=(Math.random().toString(16)+"000000000").substr(2,8);return a?"-"+b.substr(0,4)+"-"+b.substr(4,4):b}return a()+a(!0)+a(!0)+a()},f.onlyUnique=function(a,b,c){return c.indexOf(a)===b},f.getClass=function(a){if(a&&"object"==typeof a&&"[object Array]"!==Object.prototype.toString.call(a)&&a.constructor&&a!==this.window){var b=a.constructor.toString().match(/function\s*(\w+)/);if(b&&2===b.length)return b[1]}return!1},f.inArray=function(a,b,c){var d;if(b){if(b.indexOf)return b.indexOf.call(b,a,c);for(d=b.length,c=c?0>c?Math.max(0,d+c):c:0;d>c;c++)if(c in b&&b[c]===a)return c}return-1},e.CoreObject=function(){function a(){}return a.extend=function(a){a.prototype=Object.create(this.prototype),a.prototype.constructor=a,a.prototype.super_=this.prototype,a.extend=this.extend},a}(),e.playSound=function(a){if(void 0===c.ressources.sounds[a])throw new Error('No sound with name "'+a+'" found.');c.ressources.sounds[a].play()},e.pauseSound=function(a){if(void 0===c.ressources.sounds[a])throw new Error('No sound with name "'+a+'" found.');c.ressources.sounds[a].pause()},e.isSoundPlaying=function(a){if(void 0===c.ressources.sounds[a])throw new Error('No sound with name "'+a+'" found.');return!c.ressources.sounds[a].paused},e.Sprite=function(){var a,b,d,f;return Sprite=function(e){if(void 0===game.config.images[e])throw new Error('No image with name "'+e+'" found');var g=game.config.images[e],h=[];(void 0!==g.tileWidth||void 0!==g.tileHeight||void 0!==g.animations)&&(h.push("tileWidth"),h.push("tileHeight")),h.forEach(function(a){if(void 0===g[a]||""===g[a])throw new Error('No element "'+a+'" specified in data')});var i=c.ressources.images[e];void 0===g.tileWidth&&(g.tileWidth=i.width,g.tileHeight=i.height),void 0===g.animations&&(g.animations={}),void 0===g.animations.default&&(g.animations.default=[0]),a=i,b=g.tileWidth,d=g.tileHeight,this.rotation=0,this.alpha=1,f=g.animations,this.anchor={x:0,y:0},this.context=c.canvas.context;for(anim in f){this.currentAnimation=f[anim];break}this.currentFrame=0,this.lastDrawTime=Date.now(),this.frameDuration=60,this.cols=Math.floor(i.width/b),this.rows=Math.floor(i.height/d)},e.CoreObject.extend(Sprite),Sprite.prototype.draw=function(c,e,f,g){if(c-=this.anchor.x,e-=this.anchor.y,1!==this.alpha){var h=this.context.globalAlpha;this.context.globalAlpha=this.alpha}0!==this.rotation&&(this.context.save(),this.context.translate(c,e),this.context.rotate(this.rotation),this.context.translate(-c,-e));var i=f||b,j=g||d,k=this.currentAnimation[this.currentFrame],l=k%this.cols*b,m=Math.floor(k/this.cols)*d;this.context.drawImage(a,l,m,b,d,c,e,i,j);var n=Date.now(),o=n-this.lastDrawTime;o>=this.frameDuration&&(this.currentFrame++,this.currentFrame>=this.currentAnimation.length&&(this.currentFrame=0),this.lastDrawTime=n),1!==this.alpha&&(this.context.globalAlpha=h),0!==this.rotation&&this.context.restore()},Sprite.prototype.setAnimation=function(a,b){if(void 0===f[a])throw new Error("No animation with name "+a+" found");(this.currentAnimation!=f[a]||void 0!==b)&&(this.currentAnimation=f[a],this.currentFrame=b||0)},Sprite.prototype.setRotationDeg=function(a){this.setRotationRad(a*Math.PI/180)},Sprite.prototype.setRotationRad=function(a){a%=2*Math.PI,this.rotation=a},Sprite.prototype.setAlpha=function(a){a=0>a?0:a,a=a>1?1:a,this.alpha=a},Sprite.prototype.setAnchor=function(a,b){"object"==typeof a&&"undefined"!=typeof a.x&&"undefined"!=typeof a.y?(this.anchor.x=a.x,this.anchor.y=a.y):(this.anchor.x=a,this.anchor.y=b)},Sprite}(),e.Entity=function(){function a(a,b,c,d,g){this.components={},this.id=f.guid(),this.x=a,this.y=b,this.width=c,this.height=d,this.config=g;for(type in g){var h=e.components.create(type,g[type]);this.components[type]=h,h.receive("setEntity",this)}}return e.CoreObject.extend(a),a.prototype.emit=function(a,b){for(type in this.components)this.components[type].receive(a,b)},a.prototype.getComponentData=function(a,b){if(void 0===this.components[a])throw console.warn("Error in Entity "+this),new Error('No component "'+a+'" found in entity.');return this.components[a].data[b]},a.prototype.clone=function(a,b,c,d){return a=void 0===a?this.x:a,b=void 0===b?this.y:b,c=void 0===c?this.width:c,d=void 0===d?this.height:d,new e.Entity(a,b,c,d,this.config)},a}();var h=[];e.stage=d.stage={};var j={},k={x:0,y:0},l={tiles:function(a,b,d){return tilesetInfo=game.config.images[a.tileset],tileset=c.ressources.images[a.tileset],tileWidth=tilesetInfo.tileWidth,tileHeight=tilesetInfo.tileHeight,canvas=document.createElement("canvas"),context=canvas.getContext("2d"),canvas.width=b,canvas.height=d,a.tiles.forEach(function(b){var d=b[2]*tileWidth,e=b[3]*tileHeight,f=b[0]*tileWidth,g=b[1]*tileHeight;if(context.drawImage(tileset,d,e,tileWidth,tileHeight,f,g,tileWidth,tileHeight),void 0!==a.group){var h=new c.$scope.fn.Entity(f,g,tileWidth,tileHeight,{CollisionBody:{},Physics:{mass:0,forces:{}}});c.$scope.fn.addToGroup(h,a.group)}}),{buffer:canvas}},image:function(a,b,d){var e=document.createElement("canvas"),f=e.getContext("2d"),g=c.ressources.images[a.image];e.width=b,e.height=d;var h,i;switch(a["size-x"]){case"stretch":h=b;break;case"loop":case"original":case void 0:h=g.width;break;default:throw new Error('Unknow size-x: "'+a["size-x"]+'".')}switch(a["size-y"]){case"stretch":i=d;break;case"loop":case"original":case void 0:i=g.height;break;default:throw new Error('Unknow size-x: "'+a["size-x"]+'".')}var j=0,k=0;do{do f.drawImage(g,0,0,g.width,g.height,j,k,h,i),j+=h;while(b>j&&"original"!==a["size-x"]);k+=i,j=0}while(d>k&&"original"!==a["size-y"]);return{buffer:e,scrollX:a["scroll-x"],scrollY:a["scroll-y"]}}};e.stage.setLevel=function(a){if(void 0===c.ressources.levels[a])throw new Error('No level with name "'+a+'" found.');var b=c.ressources.levels[a],d=b.width,e=b.height;b.layer.forEach(function(a){if(void 0===l[a.type])throw new Error('Invalid layer type "'+a.type+'"');var b=l[a.type](a,d,e);if(void 0===b)throw new Error("Error while creating level");b.x=a.x||0,b.y=a.y||0,b.z=a.z||0,h.push(b)}),h.sort(function(a,b){return a.z>b.z?-1:a.z<b.z?1:0});var f="";if("object"==typeof b.background){var g=b.background;void 0!==g.color?f=g.color:void 0!==g.from&&void 0!==g.to&&(f="linear-gradient(to bottom, "+g.from+" 0%,"+g.to+" 100%)")}console.log("style:",f),c.canvas.style.background=f},e.stage.setFocus=function(a,b,c){a instanceof e.Entity?(j.entity=a,j.xoffset=b||0,j.yoffset=c||0):(j.x=a,j.y=b,j.entity=void 0)},function(){var a=Date.now();e.stage.update=function(){var b=Date.now();c.groups.groups.toRender.forEach(function(c){c.emit("tick",{delta:b-a})}),a=b}}(),e.stage.draw=function(){function a(a){var b=j.centerX-j.x*(a.scrollX||1)+a.x,d=j.centerY-j.y*(a.scrollY||1)+a.y;c.canvas.context.drawImage(a.buffer,b,d)}void 0===j.x&&(j.x=c.canvas.width/2,j.y=c.canvas.height/2,j.centerX=c.canvas.width/2,j.centerY=c.canvas.height/2),void 0!==j.entity&&(j.x=j.entity.x+j.xoffset,j.y=j.entity.y+j.yoffset);for(var b=0;b<h.length&&h[b].z>=0;b++)a(h[b]);for(k.x=j.centerX-j.x,k.y=j.centerY-j.y,c.groups.groups.toRender.forEach(function(a){a.emit("draw",{offsetX:k.x,offsetY:k.y})});b<h.length;b++)a(h[b])},function(){var b={};b.addEntityToGroup=function(a,b){void 0==c.groups.groups[b]&&(c.groups.groups[b]=[]),f.inArray(a,c.groups.groups[b])&&c.groups.groups[b].push(a)},b.addEntitiesToGroup=function(a,b){void 0==c.groups.groups[b]&&(c.groups.groups[b]=[]);for(var d=0;d<a.length;++d)-1===f.inArray(a[d],c.groups.groups[b])&&c.groups.groups[b].push(a[d])},b.addPairToCollingObjects=function(a){c.groups.collidingObjects.push([a[0],a[1]])},b.deleteFromCollidingObjects=function(a){for(var b=0;b<c.groups.collidingObjects.length;++b)(c.groups.collidingObjects[b][0].id==a.id||c.groups.collidingObjects[b][1].id==a.id)&&c.groups.collidingObjects.splice(b,1)},b.generateCollidingObjects=function(){c.groups.collidingObjects=[];for(var a=c.groups.collidingGroups.length;a--;)for(var d=c.groups.collidingGroups[a][0],e=c.groups.collidingGroups[a][1],f=0;f<d.length;++f)for(var g=0;g<e.length;++g)b.addPairToCollingObjects([d[f],e[g]])},c.groups={groups:{toRender:[]},collidingGroups:[]},e.defineEmptyGroup=function(a){c.groups.groups[a]=[]},e.addToGroup=function(a,c){if(a instanceof Array){for(var d=a.length;d--;)if(!(a[d]instanceof e.Entity))throw new Error("Object is not an Entity.");b.addEntitiesToGroup(a,c)}else{if(!(a instanceof e.Entity))throw new Error("Object is not an Entity.");b.addEntityToGroup(a,c)}},e.defineCollidingGroups=function(a,b){if(void 0==c.groups.groups[a]||void 0==c.groups.groups[b])throw console.log(a,void 0==c.groups.groups[a],b,void 0==c.groups.groups[b]),new Error("One of the given groups is undefined!",a,b);c.groups.collidingGroups.push([c.groups.groups[a],c.groups.groups[b]])},e.deleteCollidingGroups=function(a,b){for(var d=c.groups.collidingGroups.length;d--;)c.groups.collidingGroups[d][0]===c.groups.groups[collide]&&c.groups.collidingGroups[d][1]===c.groups[groups][b]&&c.groups.collidingGroups.splice(d,1)},e.removeEntityFromGroup=function(a,b){if(!(a instanceof e.Entity))throw new Error("Given object is not an Entity",a);var d=c.groups.groups[b].indexOf(a);-1!=d&&c.groups.groups[b].splice(d,1)},e.removeEntityFromAllGroups=function(a){if(!(a instanceof e.Entity))throw new Error("Given object is not an Entity",a);var b=e.getGroupsByEntity(a);if(b)for(var c=b.length;c--;)console.log(b[c]),e.removeEntityFromGroup(a,b[c])},e.getGroupsByEntity=function(a){if(!(a instanceof e.Entity))throw new Error("Given object is not an Entity",a);var b=[];for(var d in c.groups.groups)if(c.groups.groups.hasOwnProperty(d)){var f=c.groups.groups[d];for(var g in f)f.hasOwnProperty(g)&&a.id==f[g].id&&b.push(d)}return 0==b.length?!1:b},a.getGroups=function(){return c.groups}}(),function(){var a={rectangle:{rectangle:function(a,b){var c={},d={x:a.x-b.x,y:a.y-b.y,ax:Math.abs(a.x-b.x),ay:Math.abs(a.y-b.y)},e=a.x<b.x?d.ax+b.width:d.ax+a.width,f=a.width+b.width-e;if(f>0){var g=a.y<b.y?d.ay+b.height:d.ay+a.height,h=a.height+b.height-g;if(h>0)return h>f?(c.normal=d.x<0?{x:1,y:0}:{x:-1,y:0},c.penetration=f):(c.normal=d.y<0?{x:0,y:1}:{x:0,y:-1},c.penetration=h),c}return!1},circle:function(){return!1},pixel:function(){return!1}},circle:{rectangle:function(){a.rectangle.circle(second,first)},circle:function(a,b){var c=Math.pow(a.x-b.x,2)+Math.pow(a.y-b.y,2),d=Math.pow(a.r+b.r,2);return d>=c},pixel:function(){return!1}},pixel:{rectangle:function(){a.rectangle.pixel(second,first)},circle:function(){a.circle.pixel(second,first)},pixel:function(){return!1}}};d.colliderTesters=a,d.checkCollisions=function(){var b=c.groups.collidingGroups;for(i=b.length-1;i>=0;--i)for(var d=b[i][0].length;d--;)for(var e=b[i][1].length;e--;){var f=b[i][0][d],g=b[i][1][e],h=f.getComponentData("CollisionBody","bounds"),j=g.getComponentData("CollisionBody","bounds"),k=f.getComponentData("CollisionBody","colliderType"),l=g.getComponentData("CollisionBody","colliderType");if(void 0===h||void 0===j)throw new Error("Collision can only be tested on entities with a CollisionBody component.");h.x+=f.x,h.y+=f.y,j.x+=g.x,j.y+=g.y;var m=a[k][l](h,j);if(h.x-=f.x,h.y-=f.y,j.x-=g.x,j.y-=g.y,m!==!1){var n={normal:{x:-m.normal.x,y:-m.normal.y},penetration:m.penetration};f.emit("collision",{other:g,collision:m}),b[i][1][e].emit("collision",{other:f,collision:n})}}}}(),e.Component=function(){return Component=function(){var a=this;this.receiver={},this.on("setEntity",function(b){a.entity=b}),this.data={}},e.CoreObject.extend(Component),Component.prototype.on=function(a,b,c){if(void 0!==this.receiver[a]&&!c)throw new Error('Already defined a callback for "'+a+'"');this.receiver[a]=b},Component.prototype.receive=function(a,b){void 0!==this.receiver[a]&&this.receiver[a](b)},Component}(),e.Renderer=function(){return Renderer=function(a){e.Component.call(this);var b=this,d=a.image;if(void 0===game.config.images[d])throw new Error('No image with name "'+d+'" found');var f=game.config.images[d],g=a||{},h=[];if((void 0!==f.tileWidth||void 0!==f.tileHeight||void 0!==f.animations)&&(h.push("tileWidth"),h.push("tileHeight")),h.forEach(function(a){if(void 0===f[a]||""===f[a])throw new Error('No element "'+a+'" specified in data')}),this.image=c.ressources.images[d],void 0===f.tileWidth&&(f.tileWidth=this.image.width,f.tileHeight=this.image.height),void 0===f.animations&&(f.animations={}),void 0===f.animations.default&&(f.animations.default=[0]),this.width=f.tileWidth,this.height=f.tileHeight,this.rotation=g.rotation||0,this.alpha=void 0===g.alpha?1:g.alpha,this.animations=f.animations,this.anchor=g.anchor||{x:0,y:0},this.context=c.canvas.context,void 0===g.animation||void 0===this.animations[g.animation])for(anim in this.animations){this.currentAnimation=this.animations[anim];break}else this.currentAnimation=this.animations[g.animation];this.currentFrame=0,this.lastDrawTime=Date.now(),this.frameDuration=60,this.cols=Math.floor(b.image.width/b.width),this.rows=Math.floor(b.image.height/b.height),this.on("draw",function(a){if(x=b.entity.x+a.offsetX,y=b.entity.y+a.offsetY,x-=b.anchor.x,y-=b.anchor.y,1!==b.alpha){var c=b.context.globalAlpha;b.context.globalAlpha=b.alpha}0!==b.rotation&&(b.context.save(),b.context.translate(x,y),b.context.rotate(b.rotation),b.context.translate(-x,-y));var d=b.entity.width||b.width,e=b.entity.height||b.height,f=b.currentAnimation[b.currentFrame],g=f%b.cols*b.width,h=Math.floor(f/b.cols)*b.height;b.context.drawImage(b.image,g,h,b.width,b.height,x,y,d,e);var i=Date.now(),j=i-b.lastDrawTime;if(j>=b.frameDuration&&(b.currentFrame++,b.currentFrame>=b.currentAnimation.length&&(b.currentFrame=0),b.lastDrawTime=i),1!==b.alpha&&(b.context.globalAlpha=c),0!==b.rotation&&b.context.restore(),window.debug){var k=b.entity.getComponentData("CollisionBody","bounds");b.context.strokeStyle="#FF0000",b.context.strokeRect(x,y,b.entity.width,b.entity.height),void 0!==k&&(b.context.strokeStyle="#0000FF",b.context.strokeRect(b.entity.x+a.offsetX+k.x,b.entity.y+a.offsetY+k.y,k.width,k.height)),b.context.strokeStyle="#00FF00",b.context.strokeRect(x+b.anchor.x,y+b.anchor.y,1,1)}}),this.on("rotate",function(a){var c=0;c=void 0!==a.degree?a.degree*Math.PI/180:a.radian,a.isRelative?b.rotation+=c:b.rotation=c,b.rotation%=2*Math.PI}),this.on("changeAnimation",function(a){if(void 0===b.animations[a.animation])throw new Error("No animation with name "+a.animation+" found");(b.currentAnimation!==b.animations[a.animation]||a.restart)&&(b.currentAnimation=b.animations[a.animation],b.currentFrame=a.frame||0)}),this.on("changeOpacity",function(a){b.alpha=a.opacity||0,b.alpha=b.alpha>1?1:b.alpha<0?0:b.alpha}),this.data.anchor=this.anchor},e.Component.extend(Renderer),Renderer}(),e.components.add("Renderer",function(a){return new e.Renderer(a)}),e.StateMachine=function(){return StateMachine=function(a){e.Component.call(this);var b=this;if(this.states=a.states||{},void 0===a.default)throw console.warn("Error in StateMachine "+this),new Error("Can't find state \""+a.default+'"');this.data.currentState=a.default,this.data.currentStateObj=this.states[a.default].values,this.on("setStates",function(a){for(var c={},d=a.length;d--;){if(void 0===b.states[a[d]])throw new Error("no State with name: "+name);if(void 0!==b.states[a[d]].events)for(name in b.states[a[d]].events)b.entity.emit(name,b.states[a[d]].events[name]);for(var e in b.states[a[d]].values)b.states[a[d]].values.hasOwnProperty(e)&&(c[e]=b.states[a[d]].values[e])}b.data.currentState=a,b.data.currentStateObj=c}),this.on("addState",function(a){if(void 0===a.name)throw console.warn("Error in statemachine "+b),new Error("No name provided for new state");if(void 0===a.state)throw console.warn("Error in statemachine "+b),new Error("No state provided to add");if(void 0!=b.states[a.name])throw console.warn("Error in statemachine "+b),new Error("State: "+a.name+" already exists");b.states[a.name]=a.state})},e.Component.extend(StateMachine),StateMachine}(),e.components.add("StateMachine",function(a){return new e.StateMachine(a)}),d.on("all_plugins_loaded",d.sunrise),d.initPlugins()}($sr=window.$sr=window.$sr||{});
//# sourceMappingURL=sunrise.min.js.map