!function(a){function b(a,b){for(var c=[],e=[],f=0;f<b.length;){for(c=[],e=[];!d.isFunction(b[f]);)c.push(b[f]),f++;for(;d.isFunction(b[f]);)e.push(b[f]),f++;for(var g=0;g<c.length;g++)void 0==rootfn.controls[a][c[g]]&&(rootfn.controls[a][c[g]]=e),rootfn.controls[a][c[g]]=rootfn.controls[a][c[g]].concat(e).unique()}}var c=a.$rootScope=a.$rootScope||{};rootfn=c.fn={},c.$scope={},srfn=c.$scope.fn={},_seal=a._seal=a._seal||function(){delete a.$rootScope,delete a._seal,delete a._unseal},_unseal=a._unseal=a._unseal||function(){a.$rootScope=c,a._seal=_seal,a._unseal=_unseal},rootfn.sunrise=function(){a._seal(),rootfn.initCanvas(),srfn.loadImages(game.config.images,function(){srfn.loadLevels(game.config.levels,function(){game.init(c.$scope),rootfn.run()})})},rootfn.run=function(){rootfn.clearCanvas(),rootfn.stage.update(),rootfn.checkCollisions(),game.run(c.$scope),rootfn.stage.draw(),c.animationFrame.call(window,rootfn.run)},srfn.fps={startTime:0,frameNumber:0,getFps:function(){this.frameNumber++;var a=(new Date).getTime(),b=(a-this.startTime)/1e3,c=Math.floor(this.frameNumber/b);return b>1&&(this.startTime=(new Date).getTime(),this.frameNumber=0),c}},rootfn.init=function(){c.animationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}},c.dom=document.querySelector("div[sunriseJS-app]"),void 0!=c.dom?rootfn.init():alert("no jsengine-app found"),srfn.loadScript=function(a,b){var c=document.createElement("script");c.type="text/javascript",c.src=a,c.async=!0,c.onload=b,document.body.appendChild(c)},rootfn.initPlugins=function(){for(var a={},b=game.config.plugins.length-1;b>=0&&(a[b--]="plugins/"+game.config.plugins.pop()+".js"););for(var c in a)!function(b,c){srfn.loadScript(c,function(){delete a[b],0===Object.keys(a).length&&rootfn.emit("all_plugins_loaded")})}(c,a[c])},function(){var a={};srfn.components={},srfn.components.add=function(b,c){if(void 0!==a[b])throw new Error('Component of type "'+b+'" already exist.');a[b]=c},srfn.components.create=function(b,c){if(void 0===a[b])throw new Error('No component of type "'+b+'" exists.');return a[b](c)}}(),c.events={},c.$scope.events={},rootfn.emit=function(a,b){void 0!=c.events[a]?c.events[a].forEach(function(a){a(b)}):console.error("there is no event named: "+a)},rootfn.on=function(a,b){void 0!=c.events[a]?c.events[a].push(b):(c.events[a]=[],c.events[a].push(b))},srfn.emit=function(a,b){void 0!=c.$scope.events[a]?c.$scope.events[a].forEach(function(a){a(b)}):console.error("there is no event named: "+a)},srfn.on=function(a,b){void 0!=c.$scope.events[a]?c.$scope.events[a].push(b):(c.$scope.events[a]=[],c.$scope.events[a].push(b))},srfn.controls={},rootfn.controls={keys:{},keycallbacksDown:{},keycallbacksUp:{},keysPressed:{}},rootfn.controls.init=function(){rootfn.controls.generateKeys()},srfn.controls.onKeyDown=function(){b("keycallbacksDown",arguments)},srfn.controls.onKeyUp=function(){b("keycallbacksUp",arguments)},rootfn.handleKeyDown=function(a){if(!rootfn.controls.keysPressed[a.keyCode]){if(void 0!=rootfn.controls.keycallbacksDown[rootfn.controls.keys.names[a.keyCode]])for(var b=0;b<rootfn.controls.keycallbacksDown[rootfn.controls.keys.names[a.keyCode]].length;++b)rootfn.controls.keycallbacksDown[rootfn.controls.keys.names[a.keyCode]][b]();rootfn.controls.keysPressed[a.keyCode]=!0}},rootfn.handleKeyUp=function(a){if(void 0!=rootfn.controls.keycallbacksUp[rootfn.controls.keys.names[a.keyCode]])for(var b=0;b<rootfn.controls.keycallbacksUp[rootfn.controls.keys.names[a.keyCode]].length;++b)rootfn.controls.keycallbacksUp[rootfn.controls.keys.names[a.keyCode]][b]();rootfn.controls.keysPressed[a.keyCode]=!1},rootfn.on("canvas-fully-loaded",function(){c.canvas.addEventListener("keydown",rootfn.handleKeyDown),c.canvas.addEventListener("keyup",rootfn.handleKeyUp)}),srfn.controls.isKeyPressed=function(){var a=!0;for(i=-1;++i<arguments.length&&a;)a=rootfn.controls.keysPressed[rootfn.controls.keys.codes[arguments[i]]]||rootfn.controls.keysPressed[arguments[i]];return a},rootfn.controls.generateKeys=function(){var a={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,"pause/break":19,"caps lock":20,esc:27,space:32,"page up":33,"page down":34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,"delete":46,windows:91,"right click":93,"numpad *":106,"numpad +":107,"numpad -":109,"numpad .":110,"numpad /":111,"num lock":144,"scroll lock":145,"my computer":182,"my calculator":183,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222},b={ctl:17,pause:19,"break":19,caps:20,escape:27,pgup:33,pgdn:33,ins:45,del:46,spc:32};for(c=97;123>c;c++)a[String.fromCharCode(c)]=c-32;for(var c=48;58>c;c++)a[c-48]=c;for(c=1;13>c;c++)a["f"+c]=c+111;for(c=0;10>c;c++)a["numpad "+c]=c+96;var d={};for(c in a)d[a[c]]=c;for(var e in b)a[e]=b[e];rootfn.controls.keys.codes=a,rootfn.controls.keys.names=d},rootfn.controls.init(),c.fn.initCanvas=function(){var a=game.config.screenWidth,b=game.config.screenHeight,d=document.createElement("canvas");d.id="sunriseJS-screen",d.width=a,d.height=b,d.tabIndex="1",c.dom.appendChild(d),c.canvas=d,c.canvas.context=d.getContext("2d"),d.focus(),rootfn.emit("canvas-fully-loaded")},c.fn.clearCanvas=function(){c.canvas.context.save(),c.canvas.context.setTransform(1,0,0,1,0,0),c.canvas.context.clearRect(0,0,game.config.screenWidth,game.config.screenHeight),c.canvas.context.restore()},c.ressources={images:{},sprites:{},audio:{},levels:{}},srfn.loadImages=function(a,b){var d={},e=0;for(key in a)d[key]=a[key],e++;if(0===e)return void b();for(title in d)!function(a,e){var f,g;if(console.log(e),"object"==typeof e){if(void 0===e.source)throw new Error('No attribute "source" found in image '+title);f=e.source,g=e,g.name=title}else f=e,g={},g.name=title;if(void 0!==c.ressources.images[a])throw new Error("Imageressource with name "+a+" already exists");var h=new Image;h.onload=function(){delete d[a],c.ressources.images[a]=this;var e=!0;for(index in d){e=!1;break}e&&b()},h.src=f}(title,d[title])},srfn.loadLevels=function(a,b){var e={},f=0;for(key in a)e[key]=a[key],f++;if(0===f)return void b();for(key in e)d.ajax(e[key],function(a){c.ressources.levels[key]=JSON.parse(a),delete e[key];var d=!0;for(index in e){d=!1;break}d&&b()})};var d=c.$scope.util={};d.ajax=function(a,b,c){var d;d=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),d.onreadystatechange=function(){4==d.readyState&&200==d.status&&b(d.responseText)},d.open("GET",a,!0),c?(d.setRequestHeader("Content-type","application/x-www-form-urlencoded"),d.send(c)):d.send()},d.executeCalculation=function(b,c,e){if("object"==typeof b){if(!b instanceof a.util.Vec2)throw new Error("Can't use "+b+"as Vec2");e(b)}else{if(void 0===c||"undefined"==typeof c)throw new Error("Excpected value for y");e(new d.Vec2(b,c))}},d.isFunction=function(a){var b={};return a&&"[object Function]"===b.toString.call(a)},d.Vec2=function(a,b){if("object"==typeof a){if(!a instanceof d.Vec2)throw new Error("Can't use "+a+"as Vec2");this.x=a.x,this.y=a.y}else this.x=a,this.y=b},d.Vec2.prototype.add=function(a,b){var c=this;executeCalculation(a,b,function(a){c.x+=a.x,c.y+=a.y})},d.Vec2.add=function(a,b){return new d.Vec2(a.x+b.x,a.y+b.y)},d.Vec2.prototype.subtract=function(a,b){var c=this;executeCalculation(a,b,function(a){c.x-=a.x,c.y-=a.y})},d.Vec2.subtract=function(a,b){return new d.Vec2(a.x-b.x,a.y-b.y)},d.Vec2.prototype.sub=d.Vec2.prototype.subtract,d.Vec2.sub=d.Vec2.subtract,d.Vec2.prototype.multiply=function(a){this.x*=a,this.y*=a},d.Vec2.multiply=function(a,b){var c=new d.Vec2(a);return c.multiply(b),c},d.Vec2.prototype.mul=d.Vec2.prototype.multiply,d.Vec2.mul=d.Vec2.multiply,d.Vec2.prototype.divide=function(a){this.multiply(1/a)},d.Vec2.divide=function(a,b){var c=new d.Vec2(a);return c.divide(b),c},d.Vec2.prototype.div=d.Vec2.prototype.divide,d.Vec2.div=d.Vec2.divide,d.size=function(a){var b,c=0;for(b in a)a.hasOwnProperty(b)&&c++;return c},d.guid=function(){function a(a){var b=(Math.random().toString(16)+"000000000").substr(2,8);return a?"-"+b.substr(0,4)+"-"+b.substr(4,4):b}return a()+a(!0)+a(!0)+a()},d.getClass=function(a){if(a&&"object"==typeof a&&"[object Array]"!==Object.prototype.toString.call(a)&&a.constructor&&a!==this.window){var b=a.constructor.toString().match(/function\s*(\w+)/);if(b&&2===b.length)return b[1]}return!1},d.inArray=function(a,b,c){var d;if(b){if(b.indexOf)return b.indexOf.call(b,a,c);for(d=b.length,c=c?0>c?Math.max(0,d+c):c:0;d>c;c++)if(c in b&&b[c]===a)return c}return-1},srfn.CoreObject=function(){function a(){}return a.extend=function(a){a.prototype=Object.create(this.prototype),a.prototype.constructor=a,a.prototype.super_=this.prototype,a.extend=this.extend},a}(),srfn.Sprite=function(){var a,b,d,e;return Sprite=function(f){if(void 0===game.config.images[f])throw new Error('No image with name "'+f+'" found');var g=game.config.images[f],h=[];(void 0!==g.tileWidth||void 0!==g.tileHeight||void 0!==g.animations)&&(h.push("tileWidth"),h.push("tileHeight")),h.forEach(function(a){if(void 0===g[a]||""===g[a])throw new Error('No element "'+a+'" specified in data')});var i=c.ressources.images[f];void 0===g.tileWidth&&(g.tileWidth=i.width,g.tileHeight=i.height),void 0===g.animations&&(g.animations={}),void 0===g.animations.default&&(g.animations.default=[0]),a=i,b=g.tileWidth,d=g.tileHeight,this.rotation=0,this.alpha=1,e=g.animations,this.anchor={x:0,y:0},this.context=c.canvas.context;for(anim in e){this.currentAnimation=e[anim];break}this.currentFrame=0,this.lastDrawTime=Date.now(),this.frameDuration=60,this.cols=Math.floor(i.width/b),this.rows=Math.floor(i.height/d)},srfn.CoreObject.extend(Sprite),Sprite.prototype.draw=function(c,e,f,g){if(c-=this.anchor.x,e-=this.anchor.y,1!==this.alpha){var h=this.context.globalAlpha;this.context.globalAlpha=this.alpha}0!==this.rotation&&(this.context.save(),this.context.translate(c,e),this.context.rotate(this.rotation),this.context.translate(-c,-e));var i=f||b,j=g||d,k=this.currentAnimation[this.currentFrame],l=k%this.cols*b,m=Math.floor(k/this.cols)*d;this.context.drawImage(a,l,m,b,d,c,e,i,j);var n=Date.now(),o=n-this.lastDrawTime;o>=this.frameDuration&&(this.currentFrame++,this.currentFrame>=this.currentAnimation.length&&(this.currentFrame=0),this.lastDrawTime=n),1!==this.alpha&&(this.context.globalAlpha=h),0!==this.rotation&&this.context.restore()},Sprite.prototype.setAnimation=function(a,b){if(void 0===e[a])throw new Error("No animation with name "+a+" found");(this.currentAnimation!=e[a]||void 0!==b)&&(this.currentAnimation=e[a],this.currentFrame=b||0)},Sprite.prototype.setRotationDeg=function(a){this.setRotationRad(a*Math.PI/180)},Sprite.prototype.setRotationRad=function(a){a%=2*Math.PI,this.rotation=a},Sprite.prototype.setAlpha=function(a){a=0>a?0:a,a=a>1?1:a,this.alpha=a},Sprite.prototype.setAnchor=function(a,b){"object"==typeof a&&"undefined"!=typeof a.x&&"undefined"!=typeof a.y?(this.anchor.x=a.x,this.anchor.y=a.y):(this.anchor.x=a,this.anchor.y=b)},Sprite}(),srfn.Entity=function(){function a(a,b,c,e,f){this.components={},this.id=d.guid(),this.x=a,this.y=b,this.width=c,this.height=e,this.config=f;for(type in f){var g=srfn.components.create(type,f[type]);this.components[type]=g,g.receive("setEntity",this)}}return srfn.CoreObject.extend(a),a.prototype.emit=function(a,b){for(type in this.components)this.components[type].receive(a,b)},a.prototype.getComponentData=function(a,b){if(void 0===this.components[a])throw console.warn("Error in Entity "+this),new Error('No component "'+a+'" found in entity.');return this.components[a].data[b]},a.prototype.clone=function(a,b,c,d){return a=void 0===a?this.x:a,b=void 0===b?this.y:b,c=void 0===c?this.width:c,d=void 0===d?this.height:d,new srfn.Entity(a,b,c,d,this.config)},a}();var e=[];srfn.stage=rootfn.stage={};var f={},g={x:0,y:0},h={tiles:function(a,b,d){return tilesetInfo=game.config.images[a.tileset],tileset=c.ressources.images[a.tileset],tileWidth=tilesetInfo.tileWidth,tileHeight=tilesetInfo.tileHeight,canvas=document.createElement("canvas"),context=canvas.getContext("2d"),canvas.width=b,canvas.height=d,a.tiles.forEach(function(a){var b=a[2]*tileWidth,c=a[3]*tileHeight,d=a[0]*tileWidth,e=a[1]*tileHeight;context.drawImage(tileset,b,c,tileWidth,tileHeight,d,e,tileWidth,tileHeight)}),{buffer:canvas}},image:function(a,b,d){var e=document.createElement("canvas"),f=e.getContext("2d"),g=c.ressources.images[a.image];e.width=b,e.height=d;var h,i;switch(a["size-x"]){case"stretch":h=b;break;case"loop":case"original":case void 0:h=g.width;break;default:throw new Error('Unknow size-x: "'+a["size-x"]+'".')}switch(a["size-y"]){case"stretch":i=d;break;case"loop":case"original":case void 0:i=g.height;break;default:throw new Error('Unknow size-x: "'+a["size-x"]+'".')}var j=0,k=0;do{do f.drawImage(g,0,0,g.width,g.height,j,k,h,i),j+=h;while(b>j&&"original"!==a["size-x"]);k+=i,j=0}while(d>k&&"original"!==a["size-y"]);return{buffer:e,scrollX:a["scroll-x"],scrollY:a["scroll-y"]}}};srfn.stage.setLevel=function(a){if(void 0===c.ressources.levels[a])throw new Error('No level with name "'+a+'" found.');var b=c.ressources.levels[a],d=b.width,f=b.height;b.layer.forEach(function(a){if(void 0===h[a.type])throw new Error('Invalid layer type "'+a.type+'"');var b=h[a.type](a,d,f);if(void 0===b)throw new Error("Error while creating level");b.x=a.x||0,b.y=a.y||0,b.z=a.z||0,e.push(b)}),e.sort(function(a,b){return a.z>b.z?-1:a.z<b.z?1:0});var g="";if("object"==typeof b.background){var i=b.background;void 0!==i.color?g=i.color:void 0!==i.from&&void 0!==i.to&&(g="linear-gradient(to bottom, "+i.from+" 0%,"+i.to+" 100%)")}console.log("style:",g),c.canvas.style.background=g},srfn.stage.setFocus=function(a,b,c){a instanceof srfn.Entity?(f.entity=a,f.xoffset=b||0,f.yoffset=c||0):(f.x=a,f.y=b,f.entity=void 0)},srfn.stage.update=function(){c.groups.groups.toRender.forEach(function(a){a.emit("tick",{})})},srfn.stage.draw=function(){function a(a){var b=f.centerX-f.x*(a.scrollX||1)+a.x,d=f.centerY-f.y*(a.scrollY||1)+a.y;c.canvas.context.drawImage(a.buffer,b,d)}void 0===f.x&&(f.x=c.canvas.width/2,f.y=c.canvas.height/2,f.centerX=c.canvas.width/2,f.centerY=c.canvas.height/2),void 0!==f.entity&&(f.x=f.entity.x+f.xoffset,f.y=f.entity.y+f.yoffset);for(var b=0;b<e.length&&e[b].z>=0;b++)a(e[b]);for(g.x=f.centerX-f.x,g.y=f.centerY-f.y,c.groups.groups.toRender.forEach(function(a){a.emit("draw",{offsetX:g.x,offsetY:g.y})});b<e.length;b++)a(e[b])},function(){var a={};a.addEntityToGroup=function(a,b){void 0==c.groups.groups[b]&&(c.groups.groups[b]=[]),d.inArray(a,c.groups.groups[b])&&c.groups.groups[b].push(a)},a.addEntitiesToGroup=function(a,b){void 0==c.groups.groups[b]&&(c.groups.groups[b]=[]);for(var e=0;e<a.length;++e)-1===d.inArray(a[e],c.groups.groups[b])&&c.groups.groups[b].push(a[e])},a.addEntityToCollingObjects=function(a){for(var b=0;b<c.groups.collidingObjects.length;++b)if(c.groups.collidingObjects[b][0]==a[0]&&c.groups.collidingObjects[b][1]==a[1]||c.groups.collidingObjects[b][0]==a[1]&&c.groups.collidingObjects[b][1]==a[0])return;c.groups.collidingObjects.push([a[0],a[1]])},c.groups={groups:{toRender:[]},collidingObjects:[]},srfn.addToGroup=function(b,c){if(b instanceof Array)a.addEntitiesToGroup(b,c);else{if(!(b instanceof srfn.Entity))throw new Error("No valid object is given to put in group: "+c);a.addEntityToGroup(b,c)}},srfn.defineCollidingGroups=function(b,d){if(void 0==c.groups.groups[b]||void 0==c.groups.groups[d])throw d;for(var e=c.groups.groups[b],f=c.groups.groups[d],g=0;g<e.length;++g)for(var h=0;h<f.length;++h)a.addEntityToCollingObjects([e[g],f[h]])},srfn.removeEntityFromGroup=function(){},srfn.getGroups=function(){return c.groups}}(),function(){var a={rectangle:{rectangle:function(a,b){var c=b.x>=a.x&&b.x<=a.x+a.width;c=c||a.x>=b.x&&a.x<=b.x+b.width;var d=b.y>=a.y&&b.y<=a.y+a.height;return d=d||a.y>=b.y&&a.y<=b.y+b.height,c&&d},circle:function(){return!1},pixel:function(){return!1}},circle:{rectangle:function(){a.rectangle.circle(second,first)},circle:function(a,b){var c=Math.pow(a.x-b.x,2)+Math.pow(a.y-b.y,2),d=Math.pow(a.r+b.r,2);return d>=c},pixel:function(){return!1}},pixel:{rectangle:function(){a.rectangle.pixel(second,first)},circle:function(){a.circle.pixel(second,first)},pixel:function(){return!1}}};rootfn.colliderTesters=a,rootfn.checkCollisions=function(){var b=c.groups.collidingObjects;for(i=b.length-1;i>=0;--i){var d=b[i],e=d[0].getComponentData("CollisionBody","bounds"),f=d[1].getComponentData("CollisionBody","bounds"),g=d[0].getComponentData("CollisionBody","colliderType"),h=d[1].getComponentData("CollisionBody","colliderType");if(void 0===e||void 0===f)throw new Error("Collision can only be tested on entities with a CollisionBody component.");e.x+=d[0].x,e.y+=d[0].y,f.x+=d[1].x,f.y+=d[1].y,a[g][h](e,f)&&(d[0].emit("collision",{other:d[1]}),d[1].emit("collision",{other:d[0]})),e.x-=d[0].x,e.y-=d[0].y,f.x-=d[1].x,f.y-=d[1].y}}}(),srfn.Component=function(){return Component=function(){var a=this;this.receiver={},this.on("setEntity",function(b){a.entity=b}),this.data={}},srfn.CoreObject.extend(Component),Component.prototype.on=function(a,b,c){if(void 0!==this.receiver[a]&&!c)throw new Error('Already defined a callback for "'+a+'"');this.receiver[a]=b},Component.prototype.receive=function(a,b){void 0!==this.receiver[a]&&this.receiver[a](b)},Component}(),srfn.Renderer=function(){return Renderer=function(a){srfn.Component.call(this);var b=this,d=a.image;if(void 0===game.config.images[d])throw new Error('No image with name "'+d+'" found');var e=game.config.images[d],f=a||{},g=[];if((void 0!==e.tileWidth||void 0!==e.tileHeight||void 0!==e.animations)&&(g.push("tileWidth"),g.push("tileHeight")),g.forEach(function(a){if(void 0===e[a]||""===e[a])throw new Error('No element "'+a+'" specified in data')}),this.image=c.ressources.images[d],void 0===e.tileWidth&&(e.tileWidth=this.image.width,e.tileHeight=this.image.height),void 0===e.animations&&(e.animations={}),void 0===e.animations.default&&(e.animations.default=[0]),this.width=e.tileWidth,this.height=e.tileHeight,this.rotation=f.rotation||0,this.alpha=void 0===f.alpha?1:f.alpha,this.animations=e.animations,this.anchor=f.anchor||{x:0,y:0},this.context=c.canvas.context,void 0===f.animation||void 0===this.animations[f.animation])for(anim in this.animations){this.currentAnimation=this.animations[anim];break}else this.currentAnimation=this.animations[f.animation];this.currentFrame=0,this.lastDrawTime=Date.now(),this.frameDuration=60,this.cols=Math.floor(b.image.width/b.width),this.rows=Math.floor(b.image.height/b.height),this.on("draw",function(a){if(x=b.entity.x+a.offsetX,y=b.entity.y+a.offsetY,x-=b.anchor.x,y-=b.anchor.y,1!==b.alpha){var c=b.context.globalAlpha;b.context.globalAlpha=b.alpha}0!==b.rotation&&(b.context.save(),b.context.translate(x,y),b.context.rotate(b.rotation),b.context.translate(-x,-y));var d=b.entity.width||b.width,e=b.entity.height||b.height,f=b.currentAnimation[b.currentFrame],g=f%b.cols*b.width,h=Math.floor(f/b.cols)*b.height;b.context.drawImage(b.image,g,h,b.width,b.height,x,y,d,e);var i=Date.now(),j=i-b.lastDrawTime;j>=b.frameDuration&&(b.currentFrame++,b.currentFrame>=b.currentAnimation.length&&(b.currentFrame=0),b.lastDrawTime=i),1!==b.alpha&&(b.context.globalAlpha=c),0!==b.rotation&&b.context.restore()}),this.on("rotate",function(a){var c=0;c=void 0!==a.degree?a.degree*Math.PI/180:a.radian,a.isRelative?b.rotation+=c:b.rotation=c,b.rotation%=2*Math.PI}),this.on("changeAnimation",function(a){if(void 0===b.animations[a.animation])throw new Error("No animation with name "+a.animation+" found");(b.currentAnimation!==b.animations[a.animation]||a.restart)&&(b.currentAnimation=b.animations[a.animation],b.currentFrame=a.frame||0)}),this.on("changeOpacity",function(a){b.alpha=a.opacity||0,b.alpha=b.alpha>1?1:b.alpha<0?0:b.alpha}),this.data.anchor=this.anchor},srfn.Component.extend(Renderer),Renderer}(),srfn.components.add("Renderer",function(a){return new srfn.Renderer(a)}),srfn.StateMachine=function(){return StateMachine=function(a){srfn.Component.call(this);var b=this;this.states=a.states||{},this.currentState="default",this.data=this.states.default.values,this.on("setState",function(a){if(void 0===b.states[a])throw new Error("no State with name: "+a);if(b.currentState=a,void 0!==b.states[a].events)for(a in b.states[a].events)b.entity.emit(a,b.states[a].events[a]);b.data=b.states[b.currentState].values}),this.on("addState",function(a){if(void 0===a.name)throw console.warn("Error in statemachine "+b),new Error("No name provided for new state");if(void 0===a.state)throw console.warn("Error in statemachine "+b),new Error("No state provided to add");if(void 0!=b.states[a.name])throw console.warn("Error in statemachine "+b),new Error("State: "+a.name+" already exists");b.states[a.name]=a.state})},srfn.Component.extend(StateMachine),StateMachine}(),srfn.components.add("StateMachine",function(a){return new srfn.StateMachine(a)}),rootfn.on("all_plugins_loaded",rootfn.sunrise),rootfn.initPlugins()}($sr=window.$sr=window.$sr||{});
